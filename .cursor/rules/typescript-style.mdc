---
description: TypeScriptのコードスタイル（命名/制御フロー/コメント/出力方針）
globs: "**/*.{ts,tsx}"
alwaysApply: true
---

# 命名
- 1〜2文字の短名は避け、意味のある英単語を使う。
- 関数は動詞、変数は名詞。省略語よりも可読性を優先。
- **DTO**: Application層で定義する入力型は `XxxInput` と命名する。

# 型
- 外部公開API以外は型のエクスポートを安易に行わない。ファイルローカルで十分なものは非export。
- `any`やunsafeなキャストは避ける。
- **型アサーション（`as`キャスト）は原則禁止。型安全性を損なうため、以下の代替手段を優先する:**
  - 型ガード関数（`value is Type`）を使用して実行時バリデーションを行う
  - 型定義を修正して正しい型推論を実現する
  - ジェネリクスや型パラメータを活用する
- **`as`キャストが許容される例外的なケース:**
  - `as const`（リテラル型の固定）
  - `import { X as Y }`（名前の変更）
  - テストコードでの`as unknown`（型チェックを回避する必要がある場合）
  - 型生成専用ファイル（`types.ts`など）での`as never`
  - エラーハンドリングでの型ガード（`e as { code?: string }`など、型ガードと組み合わせて使用）

# Zodバリデーション
- Zod v4以降、`z.string().email()`や`z.string().url()`は非推奨。代わりに`z.email()`や`z.url()`を使用する。
- メソッドチェーンが必要な場合（例: `.max(320)`）も、`z.email()`や`z.url()`から開始できる。

# 制御フロー
- ガード節（早期return）を好む。深いネストは避ける。
- 無意味なtry/catchは禁止。例外が発生しうる箇所のみで使い、飲み込みはしない。
- Result型（`@repo/result`）を使用し、例外よりも戻り値でのエラーハンドリングを優先する（Serverサイド）。

# コメント
- 自明なコメントは書かない。非自明な理由・前提・注意点のみ。

# 出力
- 長い一行は折り返し。複雑な三項演算子やワンライナーは避ける。
